# 概要 #

参議院のサイトの中のリンクをたどって、押しボタン投票の結果の情報を取得し、集計可能なデータに変換して保存します。


# 詳細 #

対象にするのは「本会議投票結果」です。

## 前提 ##

参議院のサイトのレイアウトが変わると、以下の前提も変わってしまうのですが、それはそのときに考えることにします。

「ライブラリ」ページ http://www.sangiin.go.jp/japanese/kaiki/index.html からリンクをたどると、各会期の投票結果のページにたどり着くことができます。

```
「ライブラリ」ページの各会期の「投票結果」のリンク
    -> 各会期の本会議投票結果のページの各案件の投票結果へのページへのリンク
        -> 各案件の投票結果のページ
```

### 「ライブラリ」ページ ###

各会期をあわらす表のソースは次のようになっています。

```
<tr>
<td rowspan="3" class="text80">第177回国会<br>
常会</td>
<td colspan="7" class="text80">平成２３年（2011年）　１月２４日～平成２３年　６月２２日　（１５０日間）</td>
</tr>
<tr>
<td class="text80"><!--<a href="../gianjoho/old_gaiyo/177/m-177.html" title="審議概要">-->審議概要<!--</a>--></td>
<td class="text80"><a href="../joho1/kousei/koho/177/keika.htm" title="会議の経過">会議の経過</a></td>
<td class="text80"><a href="../kaigijoho/shitsugi/177/shitsugi_ind.html" title="質疑項目">質疑項目</a></td>
<td class="text80"><a href="../joho1/kousei/vote/177/vote_ind.htm" title="投票結果">投票結果</a></td>
<td class="text80"><a href="../joho1/kousei/gian/177/gian.htm" title="議案情報">議案情報</a></td>
<td class="text80"><a href="../joho1/kousei/seigan/177/seigan.htm" title="請願">請願</a></td>
</tr>
<tr> 
... 略 ...
</tr>
```

163回以降は 3行、162回以前は 2行でレイアウトが異なります。テキスト "投票結果" を持つ "a" 要素の "href" 属性の値が各会期の本会議投票結果のページの URL になります。この URL は相対パスで記述されています。

現在の「ライブラリ」ページには、このリンク以外のテキスト "投票結果" を持つ "a" 要素はありません。したがって、目的のリンクかどうかは要素名とテキストの内容だけで判断できるのですが、将来ページの内容にどのような変更があるかはわかりません。したがって、 "href" の値が "/vote\_ind.htm" で終わるものという条件を追加して判断することにします。このファイル名は、そう簡単に変わるものではないと思われるからです。

会期の種類（常会、臨時会、特別会）と、会期の開始日・終了日はこのページだけで、リンク先にはありません。会期の種類は、前後の改行などのレイアウトが不統一です。会期の終了日は、会期延長により変更される可能性があります。

### 各会期の本会議投票結果のページ ###

各案件の投票結果のページのリンクは次のようになっています。

```
<TR><TD nowrap rowspan=5 valign="top"><font size="3"><p>平成23年6月8日</p></font></TD><TD ALIGN="LEFT"><TT><font size="3"><A HREF="177-0608-v001.htm"><p>日程第１　環境の保全のための意欲の増進及び環境教育の推進に関する法律の一部を改正する法律案（衆議院提出）</p></A></font></TT></TD></TR>
```

特徴は明確です。各案件の投票結果のページはこのページと同じディレクトリにあり、相対パスとしてファイル名だけを記述しています。

### 各案件の投票結果のページ ###

コンテンツの本体の先頭には「本会議投票結果」があります。
テキスト "本会議投票結果" を持つ要素 "h1" より前の内容は無視することにします。

```
            <h1 id="Title01" class="mt10">本会議投票結果</h1>
```

その後に、日付、案件名、投票結果（投票総数、賛成票、反対票）があります。下のサンプルのように会期名がついているページとそうでないページがあります。構造で確実に判別するのは難しそうなので、テキストの内容を判断基準にします。

個別の投票を集計すれば、この投票結果と同じ数字を得ることができるはずなので、ここで投票結果の値を取得しなくてもいいのですが、検算に使うことにします。

```
<TR>
<TD colspan=12>
<DIV align="center">
<TT><font size="3"><p>
第153回国会<BR>
2001年 12月 7日<BR>
投 票 結 果<BR>
</p></font></TT>
<BR>
<TABLE width="100%" border="1">
<TR><TH align="left" valign="top" nowrap><TT><font size="3"><p>案件名：</p></font></TT></TH><TD align="left"><TT><font size="3"><p>日程第１　経済社会の急速な変化に対応して行う中高年齢者の円滑な再就職の促進、雇用の機会の創出等を図るための雇用保険法等の臨時の特例措置に関する法律案（内閣提出、衆議院送付）</p></font></TT></TD></TR>
</TABLE>
<BR>
<font size="4"><p><B>投票総数　240　　　賛成票　150　　　反対票　90</B></p></font>
```

その後に、会派ごとのブロックが続きます。会派ごとのブロックの先頭は、会派名(人数)、賛成票数、反対票数です。これも構造で確実に判別するのは難しそうなので、テキストの内容を判断基準にします。

```
<TH colspan="9" align="left" class="party"><font size="4"><p>自由民主党・保守党(115名)
<br>　　賛成票 113　　　反対票   0</p></font></TH>
```

その後に、議員ごとの投票内容が続きます。 "td" 要素が 3個続き、 3個目に "TT" 要素が入っている以外、明確な特徴はありません。 "tt" 要素はレイアウトを整えるためだと思われるものなので、ずっと将来もこのままかどうかは定かではありません。

賛成の場合

```
<TD class="pro">○</TD><TD class="con">　</TD><TD class="nam" width="142"><TT>久世　　公堯　　　　</TT></TD>
```

反対の場合

```
<TD class="pro">　</TD><TD class="con">●</TD><TD class="nam" width="142"><TT>井上　　哲士　　　　</TT></TD>
```

欠席、棄権など、どちらでもない場合（議長は通常投票しません）

```
<TD class="pro">　</TD><TD class="con">　</TD><TD class="nam" width="142"><TT>井上　　　裕　　　　</TT></TD>
```

このページのフッタ部では "table" を使っていないので、次の会派の見出しか、 `</TABLE>` のどちらかが出現したところで終了、と、判断するしかなさそうです。

## 実現方法 ##

前項までに書いた判断（本当はもっと細かい）を、どうにかしてプログラムします。